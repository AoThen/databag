name: databag-example-ssl

services:
  caddy:
    image: caddy
    restart: unless-stopped
    ports:
      - 80:80
      - 443:443
    volumes:
      # Edit the Caddyfile and replace "example.com" with your own domain
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      # Recommended by Caddy
      - caddy_data:/data
      - caddy_config:/config
    depends_on:
      - app
  app:
    image: balzock/databag:latest
    restart: unless-stopped
    volumes:
      - database:/var/lib/databag
    environment:
      - ADMIN=password
      - DATABAG_PORT=443

      # ========== 安全配置 ==========
      # WebSocket 严格模式: 0=禁用源验证, 1=启用
      - DATABAG_WS_ORIGIN_STRICT=1

      # ========== 登录安全配置 ==========
      # 以下为可选配置，未配置时使用默认值
      # - DATABAG_LOGIN_FAIL_PERIOD=300    # 登录失败锁定时间窗口（秒）
      # - DATABAG_LOGIN_FAIL_COUNT=5       # 登录失败次数阈值
      # - DATABAG_LOGIN_ALLOW_WAIT=1       # 登录失败响应延迟（秒）

      # ========== 密码强度要求 ==========
      # 注意：服务端默认已启用强密码策略（要求大小写字母、数字、特殊字符）
      # 以下配置可覆盖默认值。
      # - DATABAG_PASSWORD_MIN_LENGTH=8            # 密码最小长度（默认8）
      # - DATABAG_PASSWORD_MAX_LENGTH=128           # 密码最大长度（默认128）
      # - DATABAG_PASSWORD_REQUIRE_UPPER=true       # 要求大写字母（默认true）
      # - DATABAG_PASSWORD_REQUIRE_LOWER=true       # 要求小写字母（默认true）
      # - DATABAG_PASSWORD_REQUIRE_NUMBER=true      # 要求数字（默认true）
      # - DATABAG_PASSWORD_REQUIRE_SPECIAL=true     # 要求特殊字符（默认true）

      # ========== IP 拉黑配置 ==========
      # - DATABAG_IP_BLOCK_THRESHOLD=5     # 触发IP封禁的失败次数阈值
      # - DATABAG_IP_BLOCK_BASE_DURATION=1 # IP封禁基础时长（小时）
      # - DATABAG_IP_BLOCK_MAX_DURATION=168  # IP封禁最大时长（小时）
volumes:
  database:
  caddy_data:
  caddy_config:
